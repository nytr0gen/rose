!function(t){"use strict";t.fn.wysiwyg=function(n){var e,i,o,a=this.find(n.container),c=this.find(".toolbar-tooltip"),u=this.find(".toolbar-normal"),d=0,l=0,s=function(){c.find(t("button")).each(function(){var n=t(this).data("edit");document.queryCommandState(n)?t(this).addClass("active"):t(this).removeClass("active")})},r=function(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()},f=function(t,n){var e=t.split(" "),i=e.shift(),o=e.join(" ")+(n||"");document.execCommand(i,0,o),s(),r()},m=function(){var n=window.getSelection();if(n.getRangeAt&&n.rangeCount){e=n.getRangeAt(0);var i=n.getRangeAt(0);i.collapse(!0);var o=document.createElement("span");i.insertNode(o);var a=t(o).position();d=a.left,l=a.top,o.parentNode.removeChild(o),n.toString().length>0?(c.css({display:"inline-block",top:l-c.outerHeight()+"px",left:d+"px"}),g()):c.hide()}},g=function(){var t=window.getSelection();if(e){try{t.removeAllRanges()}catch(n){document.body.createTextRange().select(),document.selection.empty()}t.addRange(e)}},h=function(){a.find("div").each(function(){t(this).find("br").length>0?t(this).addClass("extra"):t(this).removeClass("extra")})},p=function(n){n.find("button[data-edit]").on("click",function(){g(),a.focus(),f(t(this).data("edit")),m(),c.hide()}),n.find('button[data-insert="h1"]').on("click",function(){g(),a.focus(),f("insertHTML","<h2>"+window.getSelection()+"</h2>"),m(),c.hide()}),n.find('button[data-insert="h2"]').on("click",function(){g(),a.focus(),f("insertHTML","<h3>"+window.getSelection()+"</h3>"),m(),c.hide()}),n.find('button[data-insert="bold"]').on("click",function(){g(),a.focus(),f("insertHTML","<strong>"+window.getSelection()+"</strong>"),m(),c.hide()}),n.find('button[data-insert="italic"]').on("click",function(){g(),a.focus(),f("insertHTML","<em>"+window.getSelection()+"</em>"),m(),c.hide()}),n.find('button[data-insert="blockquote"]').on("click",function(){g(),a.focus(),f("insertHTML","<blockquote>"+(""==window.getSelection()?"content...":window.getSelection())+"</blockquote>"),m(),c.hide()}),n.find('button[data-insert="page-break"]').on("click",function(){g(),a.focus(),f("insertHTML","<hr />"),console.log("da"),m(),c.hide()}),n.find('button[data-toggle="link"]').on("click",function(){o=t(document).modal({content:'URL: <input type="text" name="link" /><button name="submit-link">Add link</button>'}),g()}),n.find('button[data-toggle="image"]').on("click",function(){o=t(document).modal({content:'Image: <form method="post" action="" enctype="multipart/form-data" id="form-image"><input type="file" name="image" /><button name="submit-image">Upload image</button></form>'}),g()})};return i=t.extend({},t.fn.wysiwyg.defaults,n),i.working&&(p(c,i),p(u,i),h(),a.attr("contenteditable",!0).on("mouseup keyup",function(){m(),s(),h()}),t("body").on("mouseup",function(t){a.is(t.target)||0!==a.has(t.target).length||c.hide()}),t(document).on("click",'button[name="submit-link"]',function(){""!=t('input[name="link"]').val()&&/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(t('input[name="link"]').val())&&(g(),f("createLink",t('input[name="link"]').val()),o.close(),close())}),t(document).on("click",'button[name="submit-image"]',function(n){n.preventDefault();var e=new FormData(t("form#form-image")[0]);t.ajax({url:_url+"action/uploadImage",type:"POST",success:function(t){g(),1==t.status&&(f("insertImage",t["image-url"]),o.close()),close()},error:function(){close()},data:e,contentType:!1,processData:!1})})),this},t.fn.wysiwyg.defaults={working:!0,container:".text"}}(window.jQuery);